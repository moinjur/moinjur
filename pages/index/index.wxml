<view class="container">
  <!-- 注册选择页面 -->
  <view class="register-container" wx:if="{{showRegister && !isRegistered}}">
    <view class="register-title">欢迎使用食元养生</view>
    <view class="register-subtitle">请选择注册方式</view>
    
    <view class="register-options">
      <button 
        class="register-btn wechat {{isLoading ? 'loading' : ''}}"
        bindtap="chooseRegisterType"
        data-type="wechat"
        disabled="{{isLoading}}"
      >
        <image class="register-icon" src="/images/wechat.png" mode="aspectFit"></image>
        微信手机号快速注册
      </button>

      <view class="divider">
        <view class="line"></view>
        <text>或</text>
        <view class="line"></view>
      </view>

      <view class="manual-register" wx:if="{{registerType === 'manual' || !registerType}}">
        <button 
          class="register-btn manual"
          bindtap="chooseRegisterType"
          data-type="manual"
        >
          手机号注册
        </button>

        <block wx:if="{{registerType === 'manual'}}">
          <view class="input-group">
            <input 
              type="number" 
              placeholder="请输入手机号" 
              bindinput="handlePhoneInput"
              value="{{manualPhoneNumber}}"
              maxlength="11"
            />
            <button 
              class="verify-btn"
              bindtap="sendVerificationCode"
              disabled="{{!manualPhoneNumber}}"
            >
              获取验证码
            </button>
          </view>

          <view class="input-group" wx:if="{{showVerificationInput}}">
            <input 
              type="number" 
              placeholder="请输入验证码" 
              bindinput="handleVerificationInput"
              value="{{verificationCode}}"
              maxlength="6"
            />
            <button 
              class="submit-btn"
              bindtap="handleManualRegister"
            >
              注册
            </button>
          </view>
        </block>
      </view>
    </view>
  </view>

  <!-- 保持原有内容 -->
  <block wx:else>
    <!-- 顶部用户信息 -->
    <view class="header">
      <view class="userinfo-mini" wx:if="{{hasUserInfo}}">
        <image class="userinfo-avatar-mini" src="{{userInfo.avatarUrl}}" mode="cover"></image>
        <text class="userinfo-nickname-mini">{{userInfo.nickName}}</text>
      </view>
      <view class="weather-info">
        <text class="temperature">{{temperature}}</text>
        <text class="humidity">湿度: {{humidity}}</text>
      </view>
    </view>

    <!-- 登录区域 -->
    <view class="login-section" wx:if="{{!hasUserInfo}}">
      <view class="userinfo">
        <block wx:if="{{canIUseOpenData}}">
          <view class="userinfo-avatar">
            <open-data type="userAvatarUrl"></open-data>
          </view>
          <open-data type="userNickName"></open-data>
        </block>
        <block wx:elif="{{!hasUserInfo}}">
          <button 
            class="auth-btn {{isLoading ? 'loading' : ''}}" 
            bindtap="handleUserProfile"
            disabled="{{isLoading}}"
          > 
            {{isLoading ? '登录中...' : '微信一键登录'}}
          </button>
        </block>
      </view>
    </view>

    <!-- 每日推荐 -->
    <view class="daily-recommend">
      <view class="section-title">每日推荐</view>
      <view class="recommend-list">
        <view class="recommend-item" wx:for="{{dailyRecommends}}" wx:key="id">
          <view class="recommend-header">
            <text class="recommend-title">{{item.title}}</text>
            <text class="recommend-desc">{{item.desc}}</text>
          </view>
          <view class="recommend-content">
            <text class="recommend-food" wx:for="{{item.items}}" wx:key="*this" wx:for-item="food">{{food}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 天气建议 -->
    <view class="weather-suggestions">
      <view class="section-title">今日养生建议</view>
      <view class="suggestion-list">
        <view class="suggestion-item" wx:for="{{weatherSuggestions}}" wx:key="title">
          <text class="suggestion-title">{{item.title}}</text>
          <view class="suggestion-content">
            <text class="suggestion-text" wx:for="{{item.items}}" wx:key="*this" wx:for-item="suggestion">{{suggestion}}</text>
          </view>
        </view>
      </view>
    </view>
  </block>
</view>