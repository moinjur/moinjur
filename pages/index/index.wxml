<view class="container">
  <!-- 腾讯地图组件 -->
  <map
    id="map"
    longitude="{{longitude}}"
    latitude="{{latitude}}"
    scale="{{scale}}"
    markers="{{markers}}"
    polyline="{{polyline}}"
    circles="{{circles}}"
    controls="{{controls}}"
    include-points="{{includePoints}}"
    bindmarkertap="onMarkerTap"
    bindregionchange="onRegionChange"
    bindtap="onMapTap"
    show-location
    show-compass="{{showCompass}}"
    enable-overlooking="{{enableOverlooking}}"
    enable-zoom="{{enableZoom}}"
    enable-rotate="{{enableRotate}}"
    enable-satellite="{{enableSatellite}}"
    enable-3D="{{true}}"
    enable-building="{{enableBuilding}}"
    min-scale="{{minScale}}"
    max-scale="{{maxScale}}"
    layer-style="{{layerStyle}}"
    skew="{{skew}}"
    rotate="{{rotate}}"
    class="map"
  ></map>

  <!-- 地图控制按钮 -->
  <view class="map-controls">
    <button class="control-btn" bindtap="handleRotate">旋转</button>
    <button class="control-btn" bindtap="handleSkew">倾斜</button>
    <button class="control-btn" bindtap="toggleSatellite">
      {{enableSatellite ? '普通图' : '卫星图'}}
    </button>
  </view>

  <!-- 授权弹窗 -->
  <view class="auth-container" wx:if="{{!hasUserInfo || !isRegistered}}">
    <view class="auth-box">
      <view class="auth-title">授权提示</view>
      <view class="auth-content">为了提供更好的服务，需要获取以下权限：</view>
      
      <!-- 用户信息授权 -->
      <button 
        wx:if="{{!hasUserInfo}}"
        class="auth-btn"
        bindtap="handleUserProfile"
      >微信账号登录</button>

      <!-- 手机号授权 -->
      <button 
        wx:if="{{hasUserInfo && !isRegistered}}"
        class="auth-btn"
        open-type="getPhoneNumber"
        bindgetphonenumber="handlePhoneNumber"
      >绑定手机号</button>
    </view>
  </view>

  <!-- 用户信息展示 -->
  <view class="userinfo-container" wx:if="{{hasUserInfo}}">
    <view class="userinfo-mini">
      <image class="userinfo-avatar-mini" src="{{userInfo.avatarUrl}}" mode="cover"></image>
      <text class="userinfo-nickname-mini">{{userInfo.nickName}}</text>
    </view>
  </view>
</view>